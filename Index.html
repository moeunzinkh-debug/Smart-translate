<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Smart Translator</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Kantumruy Pro', sans-serif;
            background: radial-gradient(circle at top left, #1e293b, #0f172a);
            min-height: 100vh;
            color: #f1f5f9;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }
        .loading-ring {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        textarea {
            scrollbar-width: thin;
            scrollbar-color: #334155 transparent;
            transition: all 0.3s ease;
        }
        textarea:focus {
            background: rgba(15, 23, 42, 0.8);
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="p-4 sm:p-10">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-300 mb-2">
                បកប្រែវៃឆ្លាត (Smart SRT)
            </h1>
            <p class="text-slate-400">បកប្រែអត្ថបទ និង SRT ជាមួយ AI Gemini 1.5 Flash</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-3xl p-6 shadow-2xl">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">អត្ថបទដើម</span>
                        <select id="sourceLanguage" class="bg-slate-800 text-slate-300 text-xs rounded-lg px-2 py-1 mt-1 outline-none border border-slate-700">
                            <option value="auto">ស្វែងរកភាសាស្វ័យប្រវត្តិ</option>
                            <option value="English">English</option>
                            <option value="Khmer">Khmer</option>
                            <option value="Chinese">Chinese</option>
                        </select>
                    </div>
                    <button onclick="clearText()" class="text-slate-500 hover:text-red-400 transition-colors">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                </div>
                <textarea id="inputText" rows="12" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-slate-200 focus:outline-none" placeholder="បញ្ចូលអត្ថបទ ឬកូដ SRT នៅទីនេះ..."></textarea>
            </div>

            <div class="glass-card rounded-3xl p-6 shadow-2xl">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">លទ្ធផលបកប្រែ</span>
                        <select id="targetLanguage" class="bg-slate-800 text-blue-400 text-xs rounded-lg px-2 py-1 mt-1 outline-none border border-slate-700">
                            <option value="Khmer">Khmer (ភាសាខ្មែរ)</option>
                            <option value="English">English</option>
                            <option value="Chinese">Chinese</option>
                        </select>
                    </div>
                    <button id="copyBtn" onclick="copyTranslation()" class="text-slate-500 hover:text-blue-400 transition-colors">
                        <i data-lucide="copy" class="w-5 h-5"></i>
                    </button>
                </div>
                <textarea id="translatedOutput" rows="12" readonly class="w-full bg-slate-900/30 border border-slate-700 rounded-2xl p-4 text-blue-100 focus:outline-none" placeholder="លទ្ធផលនឹងបង្ហាញនៅទីនេះ..."></textarea>
            </div>
        </div>

        <div class="mt-8">
            <button id="translateBtn" onclick="generateTranslation()" class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 rounded-2xl font-bold shadow-lg shadow-blue-900/20 transition-all active:scale-95 flex items-center justify-center gap-3">
                <span id="loading" class="loading-ring hidden"></span>
                <i id="btnIcon" data-lucide="languages" class="w-5 h-5"></i>
                <span id="btnText">ចាប់ផ្ដើមបកប្រែ</span>
            </button>
        </div>

        <div id="messageBox" class="hidden mt-4 p-4 rounded-xl text-center text-sm"></div>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // Configuration
        const API_KEY = "AIzaSyAiZODgbIIDVtUqGuWfiuKkGwODQ2cDYZs"; 
        const MODEL_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent";

        async function generateTranslation() {
            const input = document.getElementById('inputText').value.trim();
            const srcLang = document.getElementById('sourceLanguage').value;
            const targetLang = document.getElementById('targetLanguage').value;
            
            const btn = document.getElementById('translateBtn');
            const btnText = document.getElementById('btnText');
            const loading = document.getElementById('loading');
            const icon = document.getElementById('btnIcon');
            const outputArea = document.getElementById('translatedOutput');

            if (!input) {
                showNotice("សូមបញ្ចូលអត្ថបទជាមុនសិន!", "error");
                return;
            }

            // UI State: Loading
            btn.disabled = true;
            loading.classList.remove('hidden');
            icon.classList.add('hidden');
            btnText.textContent = "កំពុងបកប្រែ...";
            outputArea.placeholder = "AI កំពុងធ្វើការបកប្រែ...";

            const systemPrompt = `You are a professional translator. 
            Your task: Translate input text into ${targetLang}.
            Rules:
            1. Output ONLY the translated text. No explanations.
            2. If the input is in SRT format (includes timestamps like 00:00:10,000 --> 00:00:12,000), you MUST maintain the exact format, sequence numbers, and timestamps. Only translate the dialogue text.
            3. Use natural sounding ${targetLang} and preserve the original tone.
            4. Do not summarize; translate accurately line by line.`;

            try {
                const response = await fetch(`${MODEL_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ 
                            parts: [{ text: `From: ${srcLang}\nTo: ${targetLang}\n\nContent:\n${input}` }] 
                        }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                if (!response.ok) throw new Error("API Connection Failed");

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    const result = data.candidates[0].content.parts[0].text;
                    outputArea.value = result;
                    showNotice("ការបកប្រែបានជោគជ័យ!", "success");
                } else {
                    throw new Error("Invalid API Response");
                }
            } catch (error) {
                console.error(error);
                showNotice("មានបញ្ហាបច្ចេកទេស៖ សូមពិនិត្យ API Key ឬអ៊ីនធឺណិត!", "error");
            } finally {
                // UI State: Reset
                btn.disabled = false;
                loading.classList.add('hidden');
                icon.classList.remove('hidden');
                btnText.textContent = "ចាប់ផ្ដើមបកប្រែ";
            }
        }

        function showNotice(msg, type) {
            const box = document.getElementById('messageBox');
            box.textContent = msg;
            box.className = `mt-4 p-4 rounded-xl text-center text-sm ${type === 'success' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 4000);
        }

        function copyTranslation() {
            const output = document.getElementById('translatedOutput');
            if (!output.value) return;
            output.select();
            document.execCommand('copy');
            showNotice("បានចម្លងទៅកាន់ Clipboard!", "success");
        }

        function clearText() {
            document.getElementById('inputText').value = "";
            document.getElementById('translatedOutput').value = "";
            document.getElementById('translatedOutput').placeholder = "លទ្ធផលនឹងបង្ហាញនៅទីនេះ...";
        }
    </script>
</body>
</html>
